function Emiya(){this.listen()}function initPageShare(){var t=$(".J_share"),e=$(".J_share_wechat"),a=e.data("url"),o=e.data("avatar"),n=encodeURIComponent(e.data("title")+" - "+e.data("blogtitle")),i=encodeURIComponent(a),r={};r.weibo="http://v.t.sina.com.cn/share/share.php?title="+n+"&url="+i+"&pic="+o,r.qzone="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+i+"&sharesource=qzone&title="+n+"&pics="+o,r.twitter="https://twitter.com/intent/tweet?status="+n+" "+i,t.on("click",function(){var t=$(this).data("type");if(t)return"wechat"===t?(0===e.find("canvas").length?$.ajax({method:"GET",url:Label.staticServePath+"/js/lib/jquery.qrcode.min.js",dataType:"script",cache:!0,success:function(){e.qrcode({width:128,height:128,text:a})}}):e.find("canvas").slideToggle(),!1):void window.open(r[t],"_blank","top=100,left=200,width=648,height=618")})}function initContents(){var i={h1:5,h2:4,h3:3,h4:2,h5:1},r=getArticleTitles();if(0!==r.length){var s,c,l='<ul class="article__contents">';r.each(function(t,e){var a=i[e.tagName.toLowerCase()],o=r.eq(t).text(),n='<li><a href="javascript:void(0);" data-target="#'+r.eq(t).attr("id")+'">'+o+"</a></li>";a&&(c?a===s?l+=n:a<s?l+=Array(s-a).fill("<ul>").join("")+n:s<a&&(l+=Array(a-s).fill("</ul>").join("")+n):(l+=n,c=a),s=a)}),l+=Array(c-s+1).fill("</ul>").join(""),$(".J_article__contents--container").append(l)}else $(".J_article__contents").hide()}var getArticleTitles=function(){var e=null;return function(){if(null!==e)return e;var t=$("[id^=b3_solo_h]");return e=t}}();function ScrollManagerCreator(t){var e,a=t,r=$(".J_navbar"),o=$(".toTop"),s=$(".J_article__contents"),c=$(".J_article__content");function n(t){var e=r.height()+1;e<t?r.addClass("is-fixed").css("top",-1*e):t<=0&&r.removeClass("is-fixed").css("top",0),r.hasClass("is-fixed")&&(a<t?r.removeClass("show"):r.addClass("show"))}function i(t){100<t?o.fadeIn():o.fadeOut()}function l(t){if(!(s.length<=0)){var e=s.prev(),a=s.height(),o=e.offset().top+e.height(),n=r.height()+1,i=c.offset().top+c.height()-a+n;a+n>$(window).height()?s.css("position","static"):t<=o-n?s.css("position","static"):o-n<t&&t<i-n?s.css({position:"fixed",top:n}):s.css({position:"absolute",top:i})}}function h(i){clearTimeout(e),e=setTimeout(function(){for(var t,e=r.height()+1,a=$(".J_article__contents--container a"),o=0;o<a.length;o++){var n=a.eq(o).attr("data-target");i+e>$(n).offset().top&&(t=o)}a.removeClass("active"),a.eq(t).addClass("active")},50)}return n(a),i(a),l(a),h(a),function(t){n(t),i(t),l(t),h(t),a=t}}function scrollTo(t){$("html ,body").animate({scrollTop:t},300)}var scrollManager=ScrollManagerCreator($(window).scrollTop());Emiya.prototype.listen=function(){$(".J_navbar_toggle").on("click",function(){var t="."+$(this).attr("data-for");$(t).hasClass("show")?$(t).removeClass("show"):$(t).addClass("show")}),$(".J_replyName").on("click",function(){var t=$(this).attr("data-originalId");$("#"+t)[0].scrollIntoViewIfNeeded(!0),$("#"+t).addClass("blink"),setTimeout(function(){$("#"+t).removeClass("blink")},3e3)}),$(".J_backToTop").on("click",function(t){scrollTo(0),t.preventDefault()}),$(window).on("scroll",function(){var t=$(window).scrollTop();scrollManager(t)}),$("body").on("click",".J_article__contents--container a",function(){var t=$(this).attr("data-target");scrollTo($(t).offset().top-$(".J_navbar").height()+1)}),$("body").on("touchstart",function(){})},Emiya.prototype.initArticle=function(){initPageShare();try{initContents()}catch(t){console.error(t)}},window.Skin=new Emiya;